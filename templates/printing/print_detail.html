









{% extends "headers.html" %}
{% load static %}

{% block title %}{{ page_title|default:"打印预览" }}{% endblock %}

{% block css %}
<style>
    /* 1. 在屏幕上模拟 A4 纸张效果 */
    .a4-preview-page {
        width: 210mm;
        padding: 10mm 10mm;
        margin: 1rem auto;
        border: 1px solid #DADADA;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        background: white;
        color: #333;
    }

    /* 2. 覆盖 Tabler 的一些默认值，使其更像报告 */
    .a4-preview-page .table {
        border: 1px solid #666;
        color: #333;
    }

    /* --- ↓↓↓ 这是屏幕显示的颜色 (保持不变) ↓↓↓ --- */
    .a4-preview-page .table thead th,
    .a4-preview-page .table-primary th {
        background-color: #0096C7 !important; /* 蓝色表头 */
        color: white !important;
        text-align: center;
        /* border: 1px solid #666; */
        border: none;
        /* font-weight: bold; */
        padding: 0.5rem;
    }
    /* --- ↑↑↑ 屏幕颜色结束 ↑↑↑ --- */

    .a4-preview-page .table td,
    .a4-preview-page .table th {
        border: 1px solid #666;
        padding: 0.5rem;
    }
    .a4-preview-page .table tbody th {
        /* background-color: #f8f9fa; */
        /* font-weight: bold; */
    }
    .a4-preview-page .table-borderless td,
    .a4-preview-page .table-borderless th {
        border: 0;
        padding: 0.25rem 0;
    }
    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        /* border-bottom: 2px solid #0096C7; */
        padding-bottom: 10px;
        margin-bottom: 10px;
    }
    .report-footer {
        text-align: left;
        margin-top: 2rem;
        font-size: 0.8rem;
        color: #555;
        /* border-top: 1px solid #ccc; */
        /* padding-top: 10px; */
    }
    .qr-container {
        display: flex;
        justify-content: space-around;
        margin-top: 2rem;
    }
    .qr-box {
        width: 205px;
        height: 205px;
        border: 2px solid #172c51;
        border-radius: 10%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 10px;
    }
    .qr-box img {
        max-width: 170px;
        max-height: 170px;
    }
    .qr-box span {
        margin-top: 5px;
        font-size: 0.9rem;
    }

    /* 3. 设置打印机打印时的样式 */
    @media print {
        /* 隐藏所有非打印内容 */
        body * {
            visibility: hidden;
        }
        .a4-preview-page, .a4-preview-page * {
            visibility: visible;
        }
        /* 移除边距、阴影，使其铺满 A4 纸 */
        .a4-preview-page {
            position: absolute;
            left: 0;
            top: 0;
            margin: 0;
            padding: 20mm 15mm;
            border: none;
            box-shadow: none;
            width: 210mm;
            max-height: 260mm;
        }

        /* --- ↓↓↓ 这是【关键修改】↓↓↓ --- */
        /* * 强制打印所有表头的背景色
         * 我们合并了所有规则，并使用 !important 来确保最高优先级
        */
        .a4-preview-page .table thead th,
        .a4-preview-page .table-primary th {
            background-color: #0096C7 !important; 
            color: white !important;
            -webkit-print-color-adjust: exact !important;
            color-adjust: exact !important;
        }
        /* --- ↑↑↑ 修改结束 ↑↑↑ --- */
        /* 尝试去掉顶部的日期和底部的页面 */
        /* @page {
            size: A4;  
            margin: 0; 
        } */

    }
</style>
{% endblock css %}

{% block content %}
<div class="page-header d-print-none"> 
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col">
        <h2 class="page-title">
          {{ page_title }}
        </h2>
      </div>
      <div class="col-auto ms-auto d-print-none">
        <button type="button" class="btn btn-primary" onclick="window.print();">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M17 17h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-14a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2"></path><path d="M17 9v-4a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v4"></path><path d="M7 13m0 2a2 2 0 0 1 2 -2h6a2 2 0 0 1 2 2v4a2 2 0 0 1 -2 2h-6a2 2 0 0 1 -2 -2z"></path></svg>
          打印
        </button>
      </div>
    </div>
  </div>
</div>

<div class="page-body">
  <div class="container-fluid">
    <div class="card a4-preview-page">
      <div class="card-body">
        
        <div class="report-header">
          <img style="height: 22px;" src="{% static "img/printing/Eyebright.png" %}" alt="Logo">
          <img style="height: 32px;" src="{% static "img/printing/pntAI.png" %}" alt="Logo">
          
        </div>
        <h1 class="text-center" style="font-weight: bold;">角膜塑形用硬性透气接触镜 (NORW) 计算结果</h3>
        <div class="d-flex justify-content-between mb-3">
          <span style="font-size: 16px;">医生姓名/ID: {{ request.user.username|default:"管理员" }}</span>
          <span style="font-size: 16px;">计算日期: {% now "Y-m-d" %}</span>
        </div>

        <table  style="width: 100%; margin-bottom: 1.5rem; color: #333; border-collapse: collapse; font-size: 16px;">
          <thead>
              <tr class="table-primary">
                  <th colspan="2" style="background-color: #00b0f0; color: white; text-align: center; padding: 0.2rem 0.5rem;  font-weight: bold;border: none;">
                      基本信息
                  </th>
              </tr>
          </thead>
          <tbody>
            <tr style="border-bottom: 3px solid #2a5282;">
                <th class="w-50" style="   border-right: none; text-align: center;">顾客姓名</th>
                <td class="w-50" style="border-left: none; text-align: center;">{{ patient.name }}</td>
            </tr>
            <tr style="border-bottom: 3px solid #2a5282;"> 
                <th style="   border-right: none; text-align: center;">顾客 ID</th>
                <td style="border-left: none; text-align: center;">{{ patient.id }}</td>
            </tr>
            <tr style="border-bottom: 3px solid #2a5282;">
                <th style="  border-right: none; text-align: center;">出生日期</th>
                <td style=" border-left: none; text-align: center;">{{ patient.birth_date|date:"Y-m-d"|default:"-" }}</td>
            </tr>
            <tr style="border-bottom: 3px solid #2a5282;">
                <th style="  border-right: none; text-align: center;">年 龄</th>
                <td style="  border-left: none; text-align: center;">{{ patient.age }}</td>
            </tr>
            <tr style="border-bottom: 3px solid #2a5282;">
                <th style="   border-right: none; border-bottom: 1px solid #555; text-align: center;">性 别</th>
                <td style=" border-left: none; border-bottom: 1px solid #555; text-align: center;">{{ patient.gender }}</td>
            </tr>
        </tbody>
      </table>

        <table class="table table-bordered mb-3" style="font-size: 16px; border: none;text-align: center;">
            <thead>
                <tr class="table-primary">
                    <th colspan="4" class="text-center" style="font-size: 16px;font-weight: bold;padding: 0.4rem 0.5rem;">验光和生物学参数</th>
                </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th colspan="2" class="text-center" style="width: 50%;background-color: white !important;color: black !important;font-size: 16px;border-right: 1px dashed black;">OD (右眼)</th>
                    <th colspan="2" class="text-center" style="width: 50%;background-color: white !important;color: black !important;font-size: 16px;">OS (左眼)</th>
                </tr>
            </thead>
            <tbody style="border: none !important; ">
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="width: 20%;border: none;padding: 0.2rem 0.5rem;">球镜度</th>
                    <td style="border-left: none;border-right: 1px dashed black;padding: 0.2rem 0.5rem;">{{ right_basic.mirror_degree|floatformat:2|default:"-" }} D</td>
                    <th style="width: 20%;border: none;padding: 0.2rem 0.5rem;">球镜度</th>
                    <td style="width: 30%;border: none;padding: 0.2rem 0.5rem;">{{ left_basic.mirror_degree|floatformat:2|default:"-" }} D</td>
                    </tr>
                    <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem 0.5rem;">柱镜度</th>
                    <td style="border-left: none;border-right: 1px dashed black;padding: 0.2rem 0.5rem;">{{ right_basic.cylindrical_power|floatformat:2|default:"-" }} D</td>
                    <th style="border: none;padding: 0.2rem 0.5rem;">柱镜度</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ left_basic.cylindrical_power|floatformat:2|default:"-" }} D</td>
                </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem 0.5rem;">轴向</th>
                    <td style="border-left: none;border-right: 1px dashed black;padding: 0.2rem 0.5rem;">{{ right_topo.plane_angle|default:"-" }}°</td>
                    <th style="border: none;padding: 0.2rem 0.5rem;">轴向</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ left_topo.plane_angle|default:"-" }}°</td>
                </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem 0.5rem;">K1@轴向</th>
                    <td style="border-left: none;border-right: 1px dashed black;padding: 0.2rem 0.5rem;">{{ right_topo.flat_k|default:"-" }} D @ {{ right_topo.plane_angle|default:"-" }}°</td>
                    <th style="border: none;padding: 0.2rem 0.5rem;">K1@轴向</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ left_topo.flat_k|default:"-" }} D @ {{ left_topo.plane_angle|default:"-" }}°</td>
                </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem 0.5rem;">K2@轴向</th>
                    <td style="border-left: none;border-right: 1px dashed black;padding: 0.2rem 0.5rem;">{{ right_topo.steep_k|default:"-" }} D @ {{ right_topo.inclined_angle|default:"-" }}°</td>
                    <th style="border: none;padding: 0.2rem 0.5rem;">K2@轴向</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ left_topo.steep_k|default:"-" }} D @ {{ left_topo.inclined_angle|default:"-" }}°</td>
                </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem 0.5rem;">测量设备</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ device_name|default:"-" }}</td>
                    <th style="border: none;padding: 0.2rem 0.5rem;">测量设备</th>
                    <td style="border: none;padding: 0.2rem 0.5rem;">{{ device_name|default:"-" }}</td>
                </tr>
            </tbody>
        </table>
        
        <table class="table table-bordered mb-3" style="font-size: 16px;border: none;">
            <thead>
                <tr class="table-primary"><th colspan="8" style="font-size: 16px;font-weight: bold;padding: 0.4rem 0.5rem;">计算结果</th></tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">眼别</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">基弧</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">反转弧径宽</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">配适弧径宽</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">中心厚度</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">总直径</th>
                    <th style="background-color: white !important;color: black !important;font-size: 16px;">颜色</th>
                    </tr>
            </thead>
            <tbody style="text-align: center; ">
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem;">OD</th>
                    <td style="border: none;padding: 0.2rem;">
                        {% if right_custom.base_arc_curvature_radius and right_basic.optical_zone_diameter %}
                            {{ right_custom.base_arc_curvature_radius|floatformat:2 }}/{{ right_basic.optical_zone_diameter }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td style="border: none;padding: 0.2rem;">{{ right_custom.reverse_arc_width|default:"-" }}</td>
                    <td style="border: none;padding: 0.2rem;">{{ right_basic.ac_arc_width|default:"-" }}</td>
                    
                    <td style="border: none;padding: 0.2rem;">{% if right_basic %}0.22{% else %}-{% endif %}</td>
                    <td style="border: none;padding: 0.2rem;">{{ right_basic.overall_diameter|default:"-" }}</td>
                    <td style="border: none;padding: 0.2rem;">{% if right_basic %}绿色{% else %}-{% endif %}</td>
                    </tr>
                <tr style="border-bottom: 3px solid #2a5282;">
                    <th style="border: none;padding: 0.2rem;">OS</th>
                    <td style="border: none;padding: 0.2rem;">
                        {% if left_custom.base_arc_curvature_radius and left_basic.optical_zone_diameter %}
                            {{ left_custom.base_arc_curvature_radius|floatformat:2 }}/{{ left_basic.optical_zone_diameter }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td style="border: none;padding: 0.2rem;">{{ left_custom.reverse_arc_width|default:"-" }}</td>
                    <td style="border: none;padding: 0.2rem;">{{ left_basic.ac_arc_width|default:"-" }}</td>
                    
                    <td style="border: none;padding: 0.2rem;">{% if left_basic %}0.22{% else %}-{% endif %}</td>
                    <td style="border: none;padding: 0.2rem;">{{ left_basic.overall_diameter|default:"-" }}</td>
                    <td style="border: none;padding: 0.2rem;">{% if left_basic %}蓝色{% else %}-{% endif %}</td>
                    </tr>
            </tbody>
        </table>

        <div class="qr-container">
            <div class="qr-box">
              <span>右眼二维码</span>
                {% if right_custom.qrcode_medment_accustomization %}
                    <img src="{{ right_custom.qrcode_medment_accustomization.url }}" alt="右眼二维码">
                {% endif %}
                
            </div>
            <div class="qr-box">
              <span>左眼二维码</span>
                {% if left_custom.qrcode_medment_accustomization %}
                    <img src="{{ left_custom.qrcode_medment_accustomization.url }}" alt="左眼二维码">
                {% endif %}
                
            </div>
            
        </div>

        <div class="report-footer">
            爱博诺德（北京）医疗科技股份有限公司<br>
            地址：北京市昌平区科技园区兴昌路9号<br>
            网址：www.ebmedical.com
        </div>

      </div>
    </div>
  </div>
</div>
{% endblock %}